<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Swimming Training Graph</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <canvas id="myChart" width="400" height="200"></canvas>

    <script>
      const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQXQPJcv3QOojPp1uw4-lpD_i0d3KnHRgdCibq9T23VsMS75Fe_wDEQG7_7sFFhowP6Jy7lJCvPDw4r/gviz/tq?tqx=out:json';

      fetch(sheetURL)
        .then(response => response.text())
        .then(dataText => {
          const json = JSON.parse(dataText.substring(47).slice(0, -2));
          const rows = json.table.rows;

          const labels = [];
          const times = [];

          rows.forEach(row => {
            const date = row.c[0]?.v;
            const stroke = row.c[1]?.v;
            const timeStr = row.c[2]?.v; // format: mm:ss

            if (date && stroke && timeStr) {
              // Extract label and convert time to float
              labels.push(`${date} (${stroke})`);
              const [min, sec] = timeStr.split(":").map(Number);
              const totalMinutes = min + sec / 60;
              times.push(totalMinutes);
            }
          });

          const ctx = document.getElementById('myChart').getContext('2d');
          new Chart(ctx, {
            type: 'line',
            data: {
              labels: labels,
              datasets: [{
                label: 'Swimming Time (minutes)',
                data: times,
                fill: false,
                borderColor: 'blue',
                tension: 0.1
              }]
            },
            options: {
              responsive: true,
              scales: {
                y: {
                  title: {
                    display: true,
                    text: 'Time (minutes)'
                  }
                }
              }
            }
          });
        })
        .catch(error => {
          console.error('Error loading data:', error);
        });
    </script>
  </body>
</html>
