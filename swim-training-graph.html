<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Swim Training Graph</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <canvas id="myChart" width="800" height="400"></canvas>

  <script>
    fetch("https://docs.google.com/spreadsheets/d/1G05TnqQZN6i5SRTyHl8MHhnvld-t-J26tlIrca99XW0/gviz/tq?tqx=out:csv")
      .then(response => response.text())
      .then(csvText => {
        const rows = csvText.trim().split("\n").slice(1); // ข้าม header
        const labels = [];
        const values = [];

        rows.forEach(row => {
          const [date, stroke, mins, secs] = row.split(",");
          labels.push(date);
          const min = parseInt(mins);
          const sec = parseInt(secs);
          const formattedTime = `${min}:${sec.toString().padStart(2, "0")}`;
          values.push({ x: date, y: min * 60 + sec, label: formattedTime });
        });

        const ctx = document.getElementById("myChart").getContext("2d");
        new Chart(ctx, {
          type: "line",
          data: {
            datasets: [{
              label: "เวลาฝึก",
              data: values,
              parsing: {
                xAxisKey: "x",
                yAxisKey: "y"
              },
              borderColor: "blue",
              borderWidth: 2,
              tension: 0.4
            }]
          },
          options: {
            plugins: {
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return values[context.dataIndex].label;
                  }
                }
              }
            },
            scales: {
              x: {
                title: {
                  display: true,
                  text: "วันที่"
                }
              },
              y: {
                title: {
                  display: true,
                  text: "เวลา (วินาที)"
                }
              }
            }
          }
        });
      });
  </script>
</body>
</html>

    }
  </script>
</body>
</html>
