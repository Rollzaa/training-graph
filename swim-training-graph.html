<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>กราฟเวลาว่ายน้ำ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        font-family: sans-serif;
        text-align: center;
        padding: 1em;
      }
      canvas {
        max-width: 90%;
        height: auto;
      }
    </style>
  </head>
  <body>
    <h2>กราฟเวลาว่ายน้ำ (แสดงเป็น นาที:วินาที)</h2>
    <canvas id="myChart"></canvas>

    <script>
      const sheetUrl =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vTT5HMe54VZWE2FKmdUOtUO0teIWGeuyQmkKTKcP6rUZDcUNHMcFZJt1OwoILkHCUt_O41aIX1EXBRz/pub?gid=0&single=true&output=csv";

      fetch(sheetUrl)
        .then((response) => response.text())
        .then((data) => {
          const rows = data.split("\n").slice(1);
          const parsed = rows
            .map((row) => {
              const [date, stroke, min, sec] = row.split(",");
              if (!date || !min || !sec) return null;
              const m = parseInt(min.trim());
              const s = parseInt(sec.trim());
              const totalSec = m * 60 + s;
              return {
                dateStr: date.trim(),
                stroke: stroke.trim(),
                displayTime: `${m}:${s.toString().padStart(2, "0")}`,
                totalSec,
                date: new Date(date.trim()),
              };
            })
            .filter((row) => row !== null);

          // เรียงตามวันที่ล่าสุด
          parsed.sort((a, b) => b.date - a.date);
          const last7 = parsed.slice(0, 7).reverse(); // เรียงกลับให้วันเก่ามาก่อน

          const labels = last7.map((item) => item.dateStr);
          const chartData = last7.map((item) => item.totalSec);
          const displayTimes = last7.map((item) => item.displayTime);

          const ctx = document.getElementById("myChart").getContext("2d");
          new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "เวลาว่ายน้ำ",
                  data: chartData,
                  fill: false,
                  borderColor: "blue",
                  tension: 0.3,
                  pointRadius: 5,
                  pointBackgroundColor: "white",
                  pointBorderWidth: 2,
                },
              ],
            },
            options: {
              responsive: true,
              plugins: {
                tooltip: {
                  callbacks: {
                    label: function (context) {
                      const i = context.dataIndex;
                      return "เวลา: " + displayTimes[i];
                    },
                  },
                },
              },
              scales: {
                y: {
                  title: {
                    display: true,
                    text: "เวลา (วินาที)",
                  },
                },
                x: {
                  title: {
                    display: true,
                    text: "วันที่",
                  },
                },
              },
            },
          });
        });
    </script>
  </body>
</html>


