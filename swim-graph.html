<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Swim Training Graph</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h2>Swim Time (7 ล่าสุด)</h2>
  <canvas id="myChart" width="400" height="200"></canvas>

  <script>
const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQXQPJcv3QOojPp1uw4-lpD_i0d3KnHRgdCibq9T23VsMS75Fe_wDEQG7_7sFFhowP6Jy7lJCvPDw4r/pub?gid=1712641251&single=true&output=csv';

fetch(csvUrl)
  .then(response => response.text())
  .then(csvText => {
    const rows = Papa.parse(csvText, { header: true }).data;

    // เรียงลำดับวันที่ล่าสุด 7 รายการ
    const sortedRows = rows
      .filter(row => row.Date && row.Minutes && row.Seconds)
      .map(row => ({
        date: row.Date,
        stroke: row.Stroke,
        minutes: parseInt(row.Minutes),
        seconds: parseInt(row.Seconds),
        time: parseInt(row.Minutes) + parseInt(row.Seconds) / 60
      }))
      .sort((a, b) => new Date(a.date) - new Date(b.date))
      .slice(-7); // เอาแค่ 7 รายการสุดท้าย

    const labels = sortedRows.map(r => r.date);
    const data = sortedRows.map(r => r.time);
    const strokes = sortedRows.map(r => r.stroke);

    const ctx = document.getElementById('swimChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'เวลา (นาที)',
          data: data,
          borderColor: 'rgba(75, 192, 192, 1)',
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          tension: 0.3,
          fill: true,
          pointRadius: 5,
          pointHoverRadius: 7
        }]
      },
      options: {
        responsive: true,
        plugins: {
          tooltip: {
            callbacks: {
              label: function(context) {
                const index = context.dataIndex;
                return `เวลา: ${context.formattedValue} นาที (${strokes[index]})`;
              }
            }
          }
        },
        scales: {
          y: {
            title: {
              display: true,
              text: 'เวลา (นาที)'
            }
          }
        }
      }
    });
  });

